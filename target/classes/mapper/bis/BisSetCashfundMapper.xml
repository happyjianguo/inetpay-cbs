<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ylink.inetpay.cbs.bis.dao.BisSetCashfundMapper" >
  <resultMap id="BaseResultMap" type="com.ylink.inetpay.common.project.cbs.dto.bis.BisSetCashfund" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Nov 20 15:16:32 CST 2016.
    -->
    <result column="ID" property="id" jdbcType="VARCHAR" />
    <result column="CASHFUND_ACCOUNT_ID" property="cashfundAccountId" jdbcType="VARCHAR" />
    <result column="BALANCE_ACCOUNT_ID" property="balanceAccountId" jdbcType="VARCHAR" />
    <result column="CASHFUND_AMOUNT" property="cashfundAmount" jdbcType="BIGINT" />
    <result column="SET_AMOUNT" property="setAmount" jdbcType="BIGINT" />
    <result column="ACTAUL_SET_AMOUNT" property="actaulSetAmount" jdbcType="BIGINT" />
    <result column="EFFECTIVE_DATE" property="effectiveDate" jdbcType="CHAR" />
    <result column="EFFECTIVE_STATUS" property="effectiveStatus" jdbcType="CHAR" />
    <result column="AUDIT_STATUS" property="auditStatus" jdbcType="CHAR" />
    <result column="CREATER" property="creater" jdbcType="VARCHAR" />
    <result column="CREATER_NAME" property="createrName" jdbcType="VARCHAR" />
    <result column="CREATE_DATETIME" property="createDatetime" jdbcType="TIMESTAMP" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
    <result column="CUST_ID" property="custId" jdbcType="VARCHAR" />
    <result column="CUST_NAME" property="custName" jdbcType="VARCHAR" />
    <result column="PROCESS_STATUS" property="processStatus" jdbcType="CHAR" />
    <result column="APPLE_TYPE" property="appleType" jdbcType="CHAR" />
    <result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
  </resultMap>
  <insert id="insert" parameterType="com.ylink.inetpay.common.project.cbs.dto.bis.BisSetCashfund">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Nov 20 15:16:32 CST 2016.
    -->
    insert into TB_BIS_SET_CASHFUND (ID, CASHFUND_ACCOUNT_ID, 
      BALANCE_ACCOUNT_ID, CASHFUND_AMOUNT, SET_AMOUNT, 
      ACTAUL_SET_AMOUNT, EFFECTIVE_DATE, EFFECTIVE_STATUS, 
      AUDIT_STATUS, CREATER, CREATER_NAME, 
      CREATE_DATETIME,REMARKS,CUST_NAME,CUST_ID,PROCESS_STATUS,APPLE_TYPE,BATCH_NO)
    values (#{id,jdbcType=VARCHAR}, #{cashfundAccountId,jdbcType=VARCHAR}, 
      #{balanceAccountId,jdbcType=VARCHAR}, #{cashfundAmount,jdbcType=BIGINT}, #{setAmount,jdbcType=BIGINT}, 
      #{actaulSetAmount,jdbcType=BIGINT}, #{effectiveDate,jdbcType=CHAR}, #{effectiveStatus,jdbcType=CHAR}, 
      #{auditStatus,jdbcType=CHAR}, #{creater,jdbcType=VARCHAR}, #{createrName,jdbcType=VARCHAR}, 
      #{createDatetime,jdbcType=TIMESTAMP},#{remarks,jdbcType=VARCHAR},#{custName,jdbcType=VARCHAR},
      #{custId,jdbcType=VARCHAR},#{processStatus,jdbcType=CHAR},#{appleType,jdbcType=CHAR},#{batchNo,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.ylink.inetpay.common.project.cbs.dto.bis.BisSetCashfund" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Nov 20 15:16:32 CST 2016.
    -->
    insert into TB_BIS_SET_CASHFUND
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="cashfundAccountId != null" >
        CASHFUND_ACCOUNT_ID,
      </if>
      <if test="balanceAccountId != null" >
        BALANCE_ACCOUNT_ID,
      </if>
      <if test="cashfundAmount != null" >
        CASHFUND_AMOUNT,
      </if>
      <if test="setAmount != null" >
        SET_AMOUNT,
      </if>
      <if test="actaulSetAmount != null" >
        ACTAUL_SET_AMOUNT,
      </if>
      <if test="effectiveDate != null" >
        EFFECTIVE_DATE,
      </if>
      <if test="effectiveStatus != null" >
        EFFECTIVE_STATUS,
      </if>
      <if test="auditStatus != null" >
        AUDIT_STATUS,
      </if>
      <if test="creater != null" >
        CREATER,
      </if>
      <if test="createrName != null" >
        CREATER_NAME,
      </if>
      <if test="createDatetime != null" >
        CREATE_DATETIME,
      </if>
      <if test="remarks != null" >
        REMARKS,
      </if>
      <if test="custId != null" >
        CUST_ID,
      </if>
      <if test="custName != null" >
        CUST_NAME,
      </if>
      <if test="processStatus != null" >
        PROCESS_STATUS,
      </if>
      <if test="appleType != null" >
        APPLE_TYPE,
      </if>
      <if test="batchNo != null" >
        BATCH_NO,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="cashfundAccountId != null" >
        #{cashfundAccountId,jdbcType=VARCHAR},
      </if>
      <if test="balanceAccountId != null" >
        #{balanceAccountId,jdbcType=VARCHAR},
      </if>
      <if test="cashfundAmount != null" >
        #{cashfundAmount,jdbcType=BIGINT},
      </if>
      <if test="setAmount != null" >
        #{setAmount,jdbcType=BIGINT},
      </if>
      <if test="actaulSetAmount != null" >
        #{actaulSetAmount,jdbcType=BIGINT},
      </if>
      <if test="effectiveDate != null" >
        #{effectiveDate,jdbcType=CHAR},
      </if>
      <if test="effectiveStatus != null" >
        #{effectiveStatus,jdbcType=CHAR},
      </if>
      <if test="auditStatus != null" >
        #{auditStatus,jdbcType=CHAR},
      </if>
      <if test="creater != null" >
        #{creater,jdbcType=VARCHAR},
      </if>
      <if test="createrName != null" >
        #{createrName,jdbcType=VARCHAR},
      </if>
      <if test="createDatetime != null" >
        #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="remarks != null" >
        #{remarks,jdbcType=VARCHAR},
      </if>
      <if test="custId != null" >
        #{custId,jdbcType=VARCHAR},
      </if>
      <if test="custName != null" >
        #{custName,jdbcType=VARCHAR},
      </if>
      <if test="processStatus != null" >
        #{processStatus,jdbcType=CHAR},
      </if>
      <if test="appleType != null" >
        #{appleType,jdbcType=CHAR},
      </if>
      <if test="batchNo != null" >
        #{batchNo,jdbcType=CHAR},
      </if>
    </trim>
  </insert>
  <sql id="Base_Column_List">
	  ID, CASHFUND_ACCOUNT_ID, 
      BALANCE_ACCOUNT_ID, CASHFUND_AMOUNT, SET_AMOUNT, 
      ACTAUL_SET_AMOUNT, EFFECTIVE_DATE, EFFECTIVE_STATUS, 
      AUDIT_STATUS, CREATER, CREATER_NAME, CREATE_DATETIME,
      REMARKS,CUST_ID,CUST_NAME,PROCESS_STATUS,APPLE_TYPE,BATCH_NO
	</sql>
  <select id="findBeanDto" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from TB_BIS_SET_CASHFUND
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  
  <select id="isWaitAudit" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from TB_BIS_SET_CASHFUND
    where
    CASHFUND_ACCOUNT_ID in
	<foreach collection="cashfundAccountIds" index="index" item="item" open="(" separator="," close=")">
        #{item,jdbcType=VARCHAR}
    </foreach>
    and (AUDIT_STATUS = #{waitAudit,jdbcType=CHAR} or (AUDIT_STATUS='01' and EFFECTIVE_STATUS='00'))
  </select>
  <select id="findListAuditPass" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from TB_BIS_SET_CASHFUND
    where EFFECTIVE_DATE <![CDATA[   <=  ]]> #{accountDate,jdbcType=CHAR}
    and AUDIT_STATUS = #{auditPass,jdbcType=CHAR}
    and PROCESS_STATUS = #{waitComplate,jdbcType=CHAR}
  </select>
  
   <update id="updateSetCashFund" parameterType="com.ylink.inetpay.common.project.cbs.dto.bis.BisSetCashfund">
    update TB_BIS_SET_CASHFUND
    set 
        CASHFUND_ACCOUNT_ID = #{cashfundAccountId,jdbcType=VARCHAR},
        BALANCE_ACCOUNT_ID = #{balanceAccountId,jdbcType=VARCHAR},
        CASHFUND_AMOUNT = #{cashfundAmount,jdbcType=BIGINT},
        SET_AMOUNT = #{setAmount,jdbcType=BIGINT},
        ACTAUL_SET_AMOUNT = #{actaulSetAmount,jdbcType=BIGINT},
        EFFECTIVE_DATE = #{effectiveDate,jdbcType=CHAR},
        EFFECTIVE_STATUS = #{effectiveStatus,jdbcType=CHAR},
        AUDIT_STATUS = #{auditStatus,jdbcType=CHAR},
        CREATER = #{creater,jdbcType=VARCHAR},
        CREATER_NAME = #{createrName,jdbcType=VARCHAR},
        CREATE_DATETIME = #{createDatetime,jdbcType=TIMESTAMP},
        CUST_ID = #{custId,jdbcType=VARCHAR},
        CUST_NAME = #{custName,jdbcType=VARCHAR},
        PROCESS_STATUS = #{processStatus,jdbcType=CHAR},
        REMARKS= #{remarks,jdbcType=VARCHAR},
        APPLE_TYPE= #{appleType,jdbcType=CHAR},
        BATCH_NO= #{batchNo,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  
   <select id="findListPage" resultMap="BaseResultMap" parameterType="com.ylink.inetpay.common.project.cbs.dto.bis.BisSetCashfund">
    select 
    <include refid="Base_Column_List" />
    from TB_BIS_SET_CASHFUND
    where 1=1
      <if test="cashfundAccountId != null and cashfundAccountId != ''">
      <!--  and CASHFUND_ACCOUNT_ID like concat('%',concat(#{cashfundAccountId,jdbcType=VARCHAR},'%')) -->
       and instr(CASHFUND_ACCOUNT_ID, #{cashfundAccountId,jdbcType=VARCHAR}) > 0
      </if>
      <if test="balanceAccountId != null and balanceAccountId != ''">
      <!--  and BALANCE_ACCOUNT_ID like concat('%',concat(#{balanceAccountId,jdbcType=VARCHAR},'%')) -->
       and instr(BALANCE_ACCOUNT_ID, #{balanceAccountId,jdbcType=VARCHAR}) > 0
      </if>  
       <if test="startCashfundAmount != null and startCashfundAmount !=''" >
      	and CASHFUND_AMOUNT <![CDATA[   >=  ]]> #{startCashfundAmount,jdbcType=BIGINT}
      </if>
       <if test="endCashfundAmount != null and endCashfundAmount !=''" >
      	and CASHFUND_AMOUNT <![CDATA[   <=  ]]> #{endCashfundAmount,jdbcType=BIGINT}
      </if>
      <if test="startSetAmount != null and startSetAmount !=''" >
      	and SET_AMOUNT <![CDATA[   >=  ]]> #{startSetAmount,jdbcType=BIGINT}
      </if>
       <if test="endSetAmount != null and endSetAmount !=''" >
      	and SET_AMOUNT <![CDATA[   <=  ]]> #{endSetAmount,jdbcType=BIGINT}
      </if>
       <if test="startActaulSetAmount != null and startActaulSetAmount !=''" >
      	and ACTAUL_SET_AMOUNT <![CDATA[   >=  ]]> #{startActaulSetAmount,jdbcType=BIGINT}
      </if>
       <if test="endActaulSetAmount != null and endActaulSetAmount !=''" >
      	and ACTAUL_SET_AMOUNT <![CDATA[   <=  ]]> #{endActaulSetAmount,jdbcType=BIGINT}
      </if>
      <if test="effectiveDate != null and effectiveDate != ''">
       and EFFECTIVE_DATE = #{effectiveDate,jdbcType=CHAR}
      </if>
      <if test="effectiveStatus != null and effectiveStatus != ''">
       and EFFECTIVE_STATUS = #{effectiveStatus,jdbcType=CHAR}
      </if>
      <if test="auditStatus != null and auditStatus != ''">
       and AUDIT_STATUS = #{auditStatus,jdbcType=CHAR}
      </if>
      <if test="creater != null and creater != ''">
       and instr(CREATER, #{creater,jdbcType=VARCHAR}) > 0
      </if>
      <if test="createrName != null and createrName != ''">
       and instr(CREATER_NAME,#{createrName,jdbcType=VARCHAR}) > 0
      </if>
      <if test="startCreateDatetime != null and startCreateDatetime != ''">
       and to_char(CREATE_DATETIME,'YYYY-MM-DD')<![CDATA[   >=  ]]>#{startCreateDatetime}
      </if>
      <if test="endCreateDatetime != null and endCreateDatetime != ''">
       and to_char(CREATE_DATETIME,'YYYY-MM-DD')<![CDATA[   <=  ]]>#{endCreateDatetime}
      </if>
      <if test="custId != null and custId != ''">
       and instr(CUST_ID, #{custId,jdbcType=VARCHAR}) > 0
       <!-- and CUST_ID = #{custId,jdbcType=VARCHAR} -->
      </if>
      <if test="custName != null and custName != ''">
       and instr(CUST_NAME, #{custName,jdbcType=VARCHAR}) > 0
       <!-- CUST_NAME = #{custName,jdbcType=VARCHAR} -->
      </if>
      <if test="processStatus != null and processStatus != ''">
        and PROCESS_STATUS = #{processStatus,jdbcType=CHAR}
      </if>
      <if test="appleType != null and appleType != ''">
        and APPLE_TYPE = #{appleType,jdbcType=CHAR}
      </if>
      <if test="batchNo != null and batchNo != ''">
        and instr(BATCH_NO,#{batchNo,jdbcType=VARCHAR})>0
      </if>
      order by CREATE_DATETIME DESC
  </select>
  <select id="getAuditNum" resultType="long" flushCache="true" useCache="false">
		select count(*) from TB_BIS_SET_CASHFUND
		where AUDIT_STATUS = #{auditPass,jdbcType=CHAR}
		AND EFFECTIVE_STATUS = #{waitEffect,jdbcType=CHAR}
		and ID in
		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
  	</select>
  	
  	<select id="findListByIds" resultMap="BaseResultMap" >
		select 
		<include refid="Base_Column_List" />
		from TB_BIS_SET_CASHFUND
		where ID in
		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
	</select>
	<update id="stopSetCashFund">
    update TB_BIS_SET_CASHFUND
    set 
        PROCESS_STATUS = #{stop,jdbcType=CHAR}
    where CASHFUND_ACCOUNT_ID in 
    <foreach collection="accountIds" index="index" item="item" open="(" separator="," close=")">
           #{item}
    </foreach>
    and PROCESS_STATUS = #{waitComplate,jdbcType=CHAR}
    and AUDIT_STATUS = #{auditPass,jdbcType=CHAR}
  </update>
  <insert id="batchCashFundExp" parameterType="list" >
     insert into TB_BIS_SET_CASHFUND (ID, CASHFUND_ACCOUNT_ID, 
      BALANCE_ACCOUNT_ID, CASHFUND_AMOUNT, SET_AMOUNT, 
      ACTAUL_SET_AMOUNT, EFFECTIVE_DATE, EFFECTIVE_STATUS, 
      AUDIT_STATUS, CREATER, CREATER_NAME, 
      CREATE_DATETIME,REMARKS,CUST_NAME,CUST_ID,PROCESS_STATUS,BATCH_NO,APPLE_TYPE)
	<foreach collection="batchDtos" index="index" item="item" separator=" union all ">
		select 
		#{item.id,jdbcType=VARCHAR}, #{item.cashfundAccountId,jdbcType=VARCHAR}, 
	    #{item.balanceAccountId,jdbcType=VARCHAR}, #{item.cashfundAmount,jdbcType=BIGINT}, #{item.setAmount,jdbcType=BIGINT}, 
	    #{item.actaulSetAmount,jdbcType=BIGINT}, #{item.effectiveDate,jdbcType=CHAR}, #{item.effectiveStatus,jdbcType=CHAR}, 
	    #{item.auditStatus,jdbcType=CHAR}, #{item.creater,jdbcType=VARCHAR}, #{item.createrName,jdbcType=VARCHAR}, 
	    #{item.createDatetime,jdbcType=TIMESTAMP},#{item.remarks,jdbcType=VARCHAR},#{item.custName,jdbcType=VARCHAR},
	    #{item.custId,jdbcType=VARCHAR},#{item.processStatus,jdbcType=CHAR},#{item.batchNo,jdbcType=VARCHAR},#{item.appleType,jdbcType=CHAR}
		from dual
	</foreach>
  </insert>
	<select id="findListByBatchNo" resultMap="BaseResultMap">
		select * from TB_BIS_SET_CASHFUND
		where BATCH_NO = #{batchNo,jdbcType=VARCHAR}
	</select>
	<update id="updateAuditStatusByBatchNo" >
	    update TB_BIS_SET_CASHFUND
	    set AUDIT_STATUS = #{auditStatus,jdbcType=CHAR}
	    where BATCH_NO = #{batchNo,jdbcType=VARCHAR}
	</update>
	<select id="findCashFundListByBatchNo" resultMap="BaseResultMap" >
		select 
		<include refid="Base_Column_List" />
		from TB_BIS_SET_CASHFUND
		where BATCH_NO = #{batchNo,jdbcType=VARCHAR}
  	</select>
</mapper>